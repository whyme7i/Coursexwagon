<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>⚡ ADMIN PORTAL ⚡</title>
<style>
body{margin:0;padding:0;font-family:'Courier New',monospace;background:#0a0a0a;color:#d4af37;}
h1,h2{text-align:center;margin:10px;}
.container{max-width:600px;margin:80px auto;padding:20px;background:#1a1a1a;border-radius:10px;}
input,textarea,select,button{width:90%;margin:8px 0;padding:10px;border-radius:5px;border:none;font-size:16px;}
input,textarea,select{background:#0a0a0a;color:#d4af37;}
button{background:#d4af37;color:#0a0a0a;font-weight:bold;cursor:pointer;}
button:hover{background:#fff;color:#0a0a0a;}
.hidden{display:none;}
.thread-box{background:#111;margin:10px 0;padding:10px;border-left:4px solid #d4af37;cursor:pointer;}
.thread-box:hover{background:#222;}
</style>
</head>
<body>

<h1>⚡ ADMIN PORTAL ⚡</h1>

<div class="container" id="loginBox">
  <h2>Admin Login</h2>
  <input type="text" id="adminName" placeholder="Admin Name">
  <input type="password" id="adminPass" placeholder="Password">
  <button onclick="loginAdmin()">Login</button>
</div>

<div class="container hidden" id="adminPanel">
  <h2>Post New Thread</h2>
  <input type="text" id="title" placeholder="Thread Title">
  <textarea id="desc" placeholder="Thread Description"></textarea>
  <input type="text" id="url" placeholder="Download Link (zip/url)">
  <input type="text" id="commentLock" placeholder="Comment to unlock link (optional)">
  <input type="text" id="emoji" placeholder="Emoji Decoration (optional)">
  <input type="text" id="social" placeholder="Optional social link">
  <select id="category">
    <option value="courses">Courses</option>
    <option value="audiobooks">Audiobooks</option>
    <option value="freebooks">FreeBooks</option>
  </select>
  <button onclick="postThread()">Post Thread</button>
  
  <h2>Existing Threads</h2>
  <div id="threadList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDXEKOmJdN8lzvnUIAhVpzarXvgxanRYgs",
  authDomain: "coursexwagon-admins.firebaseapp.com",
  projectId: "coursexwagon-admins",
  storageBucket: "coursexwagon-admins.firebasestorage.app",
  messagingSenderId: "1081264056319",
  appId: "1:1081264056319:web:99c2814d8e83571c16e9ca",
  measurementId: "G-SR53N510NN"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const admins = ["Ignacio Chamboko","Don Kyono"];
const password = "god+word";
let currentAdmin = '';

function loginAdmin(){
  const name = document.getElementById('adminName').value.trim();
  const pass = document.getElementById('adminPass').value.trim();
  if(admins.includes(name) && pass === password){
    currentAdmin = name;
    document.getElementById('loginBox').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    alert(`WELCOME ADMIN ${name}`);
    loadThreads();
  } else {
    alert("❌ Wrong Name or Password!");
  }
}

async function postThread(){
  const title = document.getElementById('title').value.trim();
  const desc = document.getElementById('desc').value.trim();
  const url = document.getElementById('url').value.trim();
  const commentLock = document.getElementById('commentLock').value.trim();
  const emoji = document.getElementById('emoji').value.trim();
  const social = document.getElementById('social').value.trim();
  const category = document.getElementById('category').value;

  if(!title || !url){alert("Title and URL are required"); return;}

  const id = 'thread-'+Date.now();
  await addDoc(collection(db, category), {id,title,desc,url,commentLock,emoji,admin:currentAdmin,social,date:new Date().toISOString()});
  alert("✅ Thread added successfully!");
  loadThreads();
}

async function loadThreads(){
  const threadList = document.getElementById('threadList');
  threadList.innerHTML = '';
  const category = document.getElementById('category').value;
  const snapshot = await getDocs(collection(db, category));
  snapshot.forEach(docSnap => {
    const t = docSnap.data();
    const div = document.createElement('div');
    div.className = 'thread-box';
    div.innerHTML = `${t.emoji? t.emoji+' ':''}${t.title} <button onclick="deleteThread('${category}','${docSnap.id}')">❌</button>
                     <button onclick="editThread('${category}','${docSnap.id}')">✏️</button>`;
    threadList.appendChild(div);
  });
}

async function deleteThread(category,id){
  if(confirm("Delete this thread?")) {
    await deleteDoc(doc(db, category, id));
    alert("Thread deleted!");
    loadThreads();
  }
}

async function editThread(category,id){
  const snapshot = await getDocs(collection(db, category));
  const t = snapshot.docs.find(d => d.id === id).data();
  const newTitle = prompt("Edit Title",t.title);
  if(newTitle) await updateDoc(doc(db, category, id), {title:newTitle});
  loadThreads();
}
</script>
</body>
</html>
