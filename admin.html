<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C.X Admin Panel</title>
<style>
  body { background: #0a0a0a; color: #fff; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0;}
  .container { background:#111; padding: 30px; border: 2px solid #fff; border-radius: 12px; width: 400px;}
  input, textarea, button { width: 100%; padding: 10px; margin: 8px 0; border-radius: 8px; border: none; font-family: inherit;}
  input, textarea { background:#222; color:#fff; }
  button { background:#fff; color:#000; cursor: pointer; font-weight: bold; transition: 0.3s; }
  button:hover { background:#d4d4d4; }
  #status { margin-top:10px; color: gold; font-weight: bold; }
</style>
</head>
<body>

<div class="container">
  <h2>C.X Admin Panel</h2>

  <div id="loginDiv">
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <div id="status"></div>
  </div>

  <div id="postDiv" style="display:none;">
    <input type="text" id="title" placeholder="Thread Title">
    <textarea id="desc" placeholder="Thread Description"></textarea>
    <input type="text" id="url" placeholder="Optional Link URL">
    <input type="text" id="emoji" placeholder="Optional Emoji">
    <button id="postBtn">Post Thread</button>
    <div id="postStatus"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDXEKOmJdN8lzvnUIAhVpzarXvgxanRYgs",
  authDomain: "coursexwagon-admins.firebaseapp.com",
  projectId: "coursexwagon-admins",
  storageBucket: "coursexwagon-admins.firebasestorage.app",
  messagingSenderId: "1081264056319",
  appId: "1:1081264056319:web:99c2814d8e83571c16e9ca",
  measurementId: "G-SR53N510NN"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function loginAdmin(username, password) {
  const q = query(
    collection(db, "admins"),
    where("username","==",username),
    where("password","==",password)
  );
  const snapshot = await getDocs(q);
  return !snapshot.empty;
}

document.getElementById("loginBtn").addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const status = document.getElementById("status");

  if(!username || !password){ status.textContent="Fill both fields!"; return; }

  const success = await loginAdmin(username,password);
  if(success){
    status.textContent="Login successful!";
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("postDiv").style.display="block";
  } else {
    status.textContent="Access denied! Wrong username or password.";
  }
});

document.getElementById("postBtn").addEventListener("click", async () => {
  const title = document.getElementById("title").value.trim();
  const desc = document.getElementById("desc").value.trim();
  const url = document.getElementById("url").value.trim();
  const emoji = document.getElementById("emoji").value.trim();
  const postStatus = document.getElementById("postStatus");

  if(!title || !desc){ postStatus.textContent="Title and description required!"; return; }

  try{
    await addDoc(collection(db,"threads"),{
      title, desc, url, emoji, admin: document.getElementById("username").value.trim(),
      createdAt: new Date().toISOString()
    });
    postStatus.textContent="Thread posted successfully!";
    document.getElementById("title").value="";
    document.getElementById("desc").value="";
    document.getElementById("url").value="";
    document.getElementById("emoji").value="";
  } catch(err){
    postStatus.textContent="Error posting thread!";
    console.error(err);
  }
});
</script>
</body>
</html>
