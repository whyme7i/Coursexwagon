<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>⚡ CourseXWagon Admin Panel ⚡</title>
<style>
body{
  margin:0; padding:0;
  font-family: 'Courier New', monospace;
  background:#1a1a1a; color:#d4af37;
}
h1,h2{text-align:center;}
.container{
  max-width:600px; margin:auto; padding:20px;
}
input, select, button, textarea{
  width:100%; margin:8px 0; padding:10px; border-radius:5px; border:1px solid #d4af37;
  background:#333; color:#d4af37; font-size:16px;
}
button{cursor:pointer; font-weight:bold; background:#d4af37; color:#1a1a1a; transition:0.3s;}
button:hover{background:#b58f1f;color:#fff;}
.postCard{
  border:2px solid #c0c0c0; border-radius:10px; margin:10px 0; padding:10px;
  background:#222;
}
.hidden{display:none;}
.loading{
  height:5px; width:0%; background:red; margin:10px 0; animation:load 5s linear forwards;
}
@keyframes load{0%{width:0%;}100%{width:100%;}}
</style>
</head>
<body>

<div class="container">
  <h1>💀 CourseXWagon Admin Panel 💀</h1>

  <div id="loginDiv">
    <h2>Admin Login</h2>
    <input type="text" id="adminName" placeholder="Admin Name">
    <input type="password" id="adminPass" placeholder="Password">
    <button onclick="loginAdmin()">Login</button>
    <div id="loginMsg"></div>
  </div>

  <div id="panelDiv" class="hidden">
    <h2>Post a Thread</h2>
    <input type="text" id="postTitle" placeholder="Thread Title">
    <textarea id="postDesc" placeholder="Thread Description"></textarea>
    <input type="text" id="postLink" placeholder="https://example.com/file.zip">
    <select id="targetPage">
      <option value="courses">Courses</option>
      <option value="audiobooks">Audiobooks</option>
      <option value="freebooks">FreeBooks</option>
    </select>
    <input type="text" id="commentLock" placeholder="Comment required to unlock (optional)">
    <input type="text" id="emojiIcon" placeholder="Emoji for thread (optional)">
    <input type="color" id="textColor" value="#d4af37">
    <input type="color" id="bgColor" value="#222222">
    <input type="text" id="profilePic" placeholder="Profile picture URL (optional)">
    <button onclick="postThread()">Add Thread</button>
    <div class="loading hidden" id="loadingBar"></div>

    <h2>Saved Threads</h2>
    <div id="savedPosts"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, collection, doc, setDoc, getDocs, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDXEKOmJdN8lzvnUIAhVpzarXvgxanRYgs",
  authDomain: "coursexwagon-admins.firebaseapp.com",
  projectId: "coursexwagon-admins",
  storageBucket: "coursexwagon-admins.firebasestorage.app",
  messagingSenderId: "1081264056319",
  appId: "1:1081264056319:web:99c2814d8e83571c16e9ca",
  measurementId: "G-SR53N510NN"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const admins = ["Ignacio Chamboko","Don Kyono"];
const adminPassword = "god+word";
let currentAdmin="";

function loginAdmin(){
  const name = document.getElementById("adminName").value.trim();
  const pass = document.getElementById("adminPass").value;
  const msgDiv = document.getElementById("loginMsg");
  if(admins.includes(name) && pass===adminPassword){
    currentAdmin=name;
    document.getElementById("loginDiv").classList.add("hidden");
    document.getElementById("panelDiv").classList.remove("hidden");
    msgDiv.innerHTML=`💀 Welcome Admin ${name} 💀`;
    loadPosts();
  } else {
    msgDiv.innerHTML="❌ Wrong name or password!";
  }
}

async function postThread(){
  const title=document.getElementById("postTitle").value.trim();
  const desc=document.getElementById("postDesc").value.trim();
  const url=document.getElementById("postLink").value.trim();
  const target=document.getElementById("targetPage").value;
  const comment=document.getElementById("commentLock").value.trim();
  const emoji=document.getElementById("emojiIcon").value.trim();
  const textColor=document.getElementById("textColor").value;
  const bgColor=document.getElementById("bgColor").value;
  const profilePic=document.getElementById("profilePic").value.trim();
  if(!title || !url){ alert("Title and Link required!"); return; }
  const postID='post-'+Date.now()+'-'+Math.floor(Math.random()*1000);

  const postData={id:postID,title,desc,url,comment,emoji,textColor,bgColor,profilePic,admin:currentAdmin,timestamp:serverTimestamp()};

  document.getElementById("loadingBar").classList.remove("hidden");

  await setDoc(doc(db,target,postID),postData);

  document.getElementById("loadingBar").classList.add("hidden");
  resetForm();
  loadPosts();
  alert("✅ Thread added successfully!");
}

function resetForm(){
  document.getElementById("postTitle").value='';
  document.getElementById("postDesc").value='';
  document.getElementById("postLink").value='';
  document.getElementById("commentLock").value='';
  document.getElementById("emojiIcon").value='';
  document.getElementById("profilePic").value='';
}

async function loadPosts(){
  const savedDiv=document.getElementById("savedPosts");
  savedDiv.innerHTML='';
  const pages=["courses","audiobooks","freebooks"];
  for(const page of pages){
    const snapshot=await getDocs(collection(db,page));
    snapshot.forEach(docSnap=>{
      const p=docSnap.data();
      const div=document.createElement("div");
      div.className="postCard";
      div.style.color=p.textColor;
      div.style.background=p.bgColor;
      div.innerHTML=`
        ${p.profilePic?`<img src="${p.profilePic}" width="50">`:""}
        <b>${p.emoji?p.emoji+" ":""}${p.title}</b><br>
        ${p.desc}<br>
        <a href="${p.url}" target="_blank">Download Link</a><br>
        ${p.comment?`<i>Comment to unlock: "${p.comment}"</i><br>`:""}
        Posted by: ${p.admin}<br>
        <button onclick="editPost('${p.id}','${page}')">Edit</button>
        <button onclick="deletePost('${p.id}','${page}')">Delete</button>
      `;
      savedDiv.appendChild(div);
    });
  }
}

async function deletePost(id,page){
  if(confirm("Delete this thread?")){
    await deleteDoc(doc(db,page,id));
    loadPosts();
  }
}

async function editPost(id,page){
  const newTitle=prompt("New Title:");
  if(!newTitle) return;
  const newDesc=prompt("New Description:");
  await setDoc(doc(db,page,id),{title:newTitle,desc:newDesc},{merge:true});
  loadPosts();
}
</script>

</body>
</html>
